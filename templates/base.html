<!doctype html>
<html lang="en" data-bs-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{% block title %}LeadGen{% endblock %}</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
      rel="stylesheet"
    />
    <link
      href="{{ url_for('static', filename='css/style.css') }}"
      rel="stylesheet"
    />
    {% block extra_css %}{% endblock %}
  </head>
  <body>
    <div class="app-wrapper">
      <!-- Sidebar -->
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-brand">
          <i class="bi bi-boxes"></i>
          <span>LeadGen</span>
        </div>

        <nav class="sidebar-nav">
          <div class="sidebar-section-label">Main</div>
          <a
            href="/dashboard"
            class="sidebar-link {% if active_page == 'dashboard' %}active{% endif %}"
          >
            <i class="bi bi-grid-1x2-fill"></i><span>Dashboard</span>
          </a>

          <div class="sidebar-section-label mt-3">Tools</div>
          <a
            href="/tools/google-maps"
            class="sidebar-link {% if active_page == 'gmaps' %}active{% endif %}"
          >
            <i class="bi bi-geo-alt-fill"></i><span>Google Maps</span>
          </a>
          <a
            href="/tools/linkedin"
            class="sidebar-link {% if active_page == 'linkedin' %}active{% endif %}"
          >
            <i class="bi bi-linkedin"></i><span>LinkedIn</span>
          </a>
          <a
            href="/tools/instagram"
            class="sidebar-link {% if active_page == 'instagram' %}active{% endif %}"
          >
            <i class="bi bi-instagram"></i><span>Instagram</span>
          </a>
          <a
            href="/tools/web-crawler"
            class="sidebar-link {% if active_page == 'webcrawler' %}active{% endif %}"
          >
            <i class="bi bi-globe2"></i><span>Web Crawler</span>
          </a>

          <div class="sidebar-section-label mt-3">Data</div>
          <a
            href="/database"
            class="sidebar-link {% if active_page == 'database' %}active{% endif %}"
          >
            <i class="bi bi-database-fill"></i><span>My Database</span>
          </a>

          <div class="sidebar-section-label mt-3">Account</div>
          <a
            href="/settings"
            class="sidebar-link {% if active_page == 'settings' %}active{% endif %}"
          >
            <i class="bi bi-gear-fill"></i><span>Settings</span>
          </a>
        </nav>

        <div class="sidebar-footer">
          <div class="sidebar-user">
            <a
              href="/settings"
              class="sidebar-avatar"
              title="Account Settings"
              style="text-decoration: none; color: inherit"
            >
              <i class="bi bi-person-fill"></i>
            </a>
            <div class="sidebar-user-info">
              <div class="sidebar-user-name" id="sidebarUserName">User</div>
              <div class="sidebar-user-email" id="sidebarUserEmail">â€”</div>
            </div>
            <a href="/logout" class="sidebar-logout" title="Sign Out">
              <i class="bi bi-box-arrow-right"></i>
            </a>
          </div>
        </div>
      </aside>

      <!-- Main content area -->
      <div class="main-content">
        <!-- Top bar (mobile toggle + breadcrumb) -->
        <header class="topbar">
          <button
            class="btn btn-link sidebar-toggle d-lg-none"
            id="sidebarToggle"
          >
            <i class="bi bi-list fs-4"></i>
          </button>
          <div class="topbar-title">{% block topbar_title %}{% endblock %}</div>
          <div class="topbar-right">
            <span
              class="badge bg-success-subtle text-success-emphasis"
              id="topbarStatus"
            >
              <i class="bi bi-circle-fill me-1" style="font-size: 0.5rem"></i
              >Active
            </span>
          </div>
        </header>

        <main class="content-area">{% block content %}{% endblock %}</main>
      </div>
    </div>

    <!-- Sidebar overlay for mobile -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Sidebar toggle
      const sidebar = document.getElementById("sidebar");
      const overlay = document.getElementById("sidebarOverlay");
      const toggle = document.getElementById("sidebarToggle");
      if (toggle) {
        toggle.addEventListener("click", () => {
          sidebar.classList.toggle("open");
          overlay.classList.toggle("show");
        });
      }
      if (overlay) {
        overlay.addEventListener("click", () => {
          sidebar.classList.remove("open");
          overlay.classList.remove("show");
        });
      }

      // Load user info
      fetch("/api/auth/me")
        .then((r) => r.json())
        .then((u) => {
          if (u.full_name)
            document.getElementById("sidebarUserName").textContent =
              u.full_name;
          if (u.email)
            document.getElementById("sidebarUserEmail").textContent = u.email;
          if (!u.is_active) {
            const badge = document.getElementById("topbarStatus");
            badge.className = "badge bg-warning-subtle text-warning-emphasis";
            badge.innerHTML =
              '<i class="bi bi-circle-fill me-1" style="font-size:.5rem;"></i>Inactive';
          }
        })
        .catch(() => {});
    </script>
    {% block extra_js %}{% endblock %}
  </body>
</html>
